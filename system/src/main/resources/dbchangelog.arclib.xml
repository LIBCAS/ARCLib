<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <property name="now" value="sysdate" dbms="oracle"/>
    <property name="now" value="getDate()" dbms="mssql"/>
    <property name="now" value="now()" dbms="mysql"/>
    <property name="now" value="now()" dbms="postgresql"/>
    <include file="dbchangelog.core.xml"/>
    <changeSet id="arclib:1" author="hochla">
        <createTable tableName="arclib_sip_profile">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_sip_profile_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="xsl" type="nclob"/>
            <column name="package_type" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="authorial_id_file_path_glob_pattern" type="varchar(2000)"/>
            <column name="authorial_id_xpath" type="varchar(2000)"/>
            <column name="sip_metadata_path_glob_pattern" type="varchar(2000)"/>
        </createTable>

        <createTable tableName="arclib_validation_profile">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_validation_profile_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="xml" type="nclob"/>
        </createTable>

        <createTable tableName="arclib_producer">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_producer_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="transfer_area_path" type="varchar(2000)"/>
        </createTable>

        <createTable tableName="arclib_workflow_definition">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_workflow_definition_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="bpmn_definition" type="nclob"/>
        </createTable>

        <createTable tableName="arclib_producer_profile">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_producer_profile_pkey" nullable="false"/>
            </column>
            <column name="external_id" type="varchar(255)"/>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="workflow_definition_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_workflow_definition_fk"
                             referencedTableName="arclib_workflow_definition" referencedColumnNames="id"/>
            </column>

            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>

            <column name="validation_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_validation_profile_fk"
                             referencedTableName="arclib_validation_profile" referencedColumnNames="id"/>
            </column>

            <column name="sip_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_sip_profile_fk"
                             referencedTableName="arclib_sip_profile" referencedColumnNames="id"/>
            </column>

            <column name="workflow_config" type="nclob"/>
            <column name="debugging_mode_active" type="boolean"/>
        </createTable>

        <insert tableName="uas_sequence">
            <column name="id" value="7c5a958a-7b8b-41f7-a8be-49aa07a13261"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="producer_profile"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>

        <createTable tableName="arclib_batch">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_batch_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="state" type="varchar(2000)"/>
            <column name="producer_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_producer_profile_fk"
                             referencedTableName="arclib_producer_profile" referencedColumnNames="id"/>
            </column>
            <column name="workflow_config" type="nclob"/>
            <column name="transfer_area_path" type="varchar(2000)"/>
            <column name="debugging_mode_active" type="boolean"/>
            <column name="bpm_def_deployed" type="boolean"/>
        </createTable>

        <createTable tableName="arclib_ingest_workflow_failure_info">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_workflow_failure_info_pkey"
                             nullable="false"/>
            </column>
            <column name="msg" type="text"/>
            <column name="stack_trace" type="nclob"/>
            <column name="ingest_workflow_failure_type" type="varchar(255)"/>
        </createTable>

        <createTable tableName="arclib_authorial_package">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_authorial_package_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="authorial_id" type="varchar(255)"/>
            <column name="producer_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_producer_profile_fk"
                             referencedTableName="arclib_producer_profile" referencedColumnNames="id"/>
            </column>
        </createTable>

        <addUniqueConstraint
                columnNames="authorial_id, producer_profile_id"
                tableName="arclib_authorial_package"
        />

        <createTable tableName="arclib_sip">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_sip_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="folder_structure" type="bytea"/>
            <column name="authorial_package_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_authorial_package_fk"
                             referencedTableName="arclib_authorial_package" referencedColumnNames="id"/>
            </column>
            <column name="previous_version_sip_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_previous_version_sip_fk"
                             referencedTableName="arclib_sip" referencedColumnNames="id"/>
            </column>
            <column name="version_number" type="int"/>
        </createTable>

        <createTable tableName="arclib_hash">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_hash_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="hash_value" type="nvarchar(2000)"/>
            <column name="hash_type" type="varchar(255)"/>
        </createTable>

        <createTable tableName="arclib_ingest_workflow">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_workflow_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="file_name" type="nvarchar(2000)"/>

            <column name="external_id" type="varchar(255)"/>
            <column name="processing_state" type="varchar(2000)"/>
            <column name="versioning_level" type="varchar(255)"/>
            <column name="xml_version_number" type="int"/>
            <column name="sip_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_sip_fk"
                             referencedTableName="arclib_sip" referencedColumnNames="id"/>
            </column>
            <column name="batch_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_batch_fk"
                             referencedTableName="arclib_batch" referencedColumnNames="id"/>
            </column>
            <column name="ingest_workflow_failure_info_id" type="varchar(255)">
                <constraints foreignKeyName="sip_ingest_workflow_failure_info_fk"
                             referencedTableName="arclib_ingest_workflow_failure_info" referencedColumnNames="id"/>
            </column>
            <column name="related_workflow_id" type="varchar(255)">
                <constraints foreignKeyName="related_ingest_workflow_fk"
                             referencedTableName="arclib_ingest_workflow" referencedColumnNames="id"/>
            </column>
            <column name="hash_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_hash_fk"
                             referencedTableName="arclib_hash" referencedColumnNames="id"/>
            </column>
            <column name="is_latest_version" type="boolean"/>
            <column name="arclib_xml_hash_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_xml_hash_fk"
                             referencedTableName="arclib_hash" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_report">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_report_pkey" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="template" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="compiled" type="bytea">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="arclib_user">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_user_pkey" nullable="false"/>
            </column>
            <column name="username" type="nvarchar(255)">
                <constraints unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="first_name" type="nvarchar(255)"/>
            <column name="last_name" type="nvarchar(255)"/>
            <column name="ldap_dn" type="nvarchar(255)"/>
            <column name="email" type="nvarchar(255)"/>
            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="user_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_ingest_routine">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_routine_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="producer_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_producer_profile_fk"
                             referencedTableName="arclib_producer_profile" referencedColumnNames="id"/>
            </column>
            <column name="transfer_area_path" type="varchar(2000)"/>
            <column name="workflow_config" type="nclob"/>

            <column name="job_id" type="varchar(255)">
                <constraints foreignKeyName="uas_job_fk"
                             referencedTableName="uas_job" referencedColumnNames="id"/>
            </column>

            <column name="creator_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_aip_query">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_aip_query_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="query" type="bytea"/>
            <column name="result" type="bytea"/>
            <column name="user_id" type="varchar(255)">
                <constraints foreignKeyName="aip_query_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_sip_h">
            <column name="sip_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_sip_hashes_s_fk"
                             referencedTableName="arclib_sip" referencedColumnNames="id" deleteCascade="true"/>
            </column>

            <column name="hash_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_sip_hashes_h_fk"
                             referencedTableName="arclib_hash" referencedColumnNames="id" deleteCascade="true"/>
            </column>
        </createTable>

        <createTable tableName="arclib_role">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_role_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="nclob"/>
        </createTable>

        <createTable tableName="arclib_assigned_role">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_assigned_role_pkey" nullable="false"/>
            </column>
            <column name="user_id" type="varchar(255)"/>
            <column name="role_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_assigned_role_role_fk"
                             referencedTableName="arclib_role" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_authorial_package_update_lock">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_authorial_package_update_lock_pkey"
                             nullable="false"/>
            </column>
            <column name="authorial_package_id" type="varchar(255)">
                <constraints unique="true" foreignKeyName="authorial_packge_fk"
                             referencedTableName="arclib_authorial_package" referencedColumnNames="id"
                             deleteCascade="true"/>
            </column>
            <column name="locked" type="boolean"/>
            <column name="latest_locked_instant" type="datetime"/>
            <column name="timeout_check_job_id" type="varchar(255)">
                <constraints foreignKeyName="uas_job_fk"
                             referencedColumnNames="id" referencedTableName="uas_job"/>
            </column>
            <column name="locked_by_user_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_locked_by_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_aip_deletion_request">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_deletion_request_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="aip_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_aip_fk"
                             referencedTableName="arclib_sip" referencedColumnNames="id"/>
            </column>
            <column name="requester_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_requester_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
            <column name="confirmer1_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_confirmer_1_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
            <column name="confirmer2_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_confirmer_2_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="format_name" type="nvarchar(255)"/>
            <column name="threat_level" type="nvarchar(255)"/>
            <column name="puid" type="varchar(255)"/>
            <column name="format_id" type="int"/>
        </createTable>

        <createTable tableName="arclib_related_format">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_related_format_pkey" nullable="false"/>
            </column>
            <column name="relationship_type" type="nvarchar(255)"/>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="internal_version_number" type="integer"/>
            <column name="related_format_name" type="nvarchar(255)"/>
            <column name="related_format_version" type="nvarchar(255)"/>
            <column name="related_format_id" type="int"/>
        </createTable>

        <createTable tableName="arclib_format_identifier">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_identifier_pkey" nullable="false"/>
            </column>
            <column name="identifier_type" type="nvarchar(255)"/>
            <column name="identifier" type="nvarchar(255)"/>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
        </createTable>

        <createTable tableName="arclib_risk">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_risk_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="nvarchar(6000)"/>
        </createTable>

        <createTable tableName="arclib_format_r_r">
            <column name="format_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_r_r_f_fk"
                             referencedTableName="arclib_format" referencedColumnNames="id"/>
            </column>

            <column name="related_risk_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_r_r_r_r_fk"
                             referencedTableName="arclib_risk" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_tool">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_tool_pkey" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)"/>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="version" type="text"/>
            <column name="description" type="nvarchar(4000)"/>
            <column name="tool_function" type="nvarchar(255)"/>
            <column name="license_information" type="nvarchar(2000)"/>
            <column name="documentation" type="nclob"/>
            <column name="format_relation_type" type="varchar(255)"/>
            <column name="format_relation_value" type="nvarchar(255)"/>
            <column name="internal" type="boolean"/>
        </createTable>
        <addUniqueConstraint tableName="arclib_tool" columnNames="name, version"/>

        <createTable tableName="arclib_export_routine">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_export_routine_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="export_time" type="datetime"/>

            <column name="export_location_path" type="varchar(2000)"/>

            <column name="aip_query_id" type="varchar(255)">
                <constraints foreignKeyName="aip_query_fk"
                             referencedTableName="arclib_aip_query" referencedColumnNames="id"/>
            </column>

            <column name="job_id" type="varchar(255)">
                <constraints foreignKeyName="uas_job_fk"
                             referencedTableName="uas_job" referencedColumnNames="id"/>
            </column>

            <column name="creator_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>

            <column name="type" type="varchar(255)"/>
        </createTable>

        <insert tableName="uas_sequence">
            <column name="id" value="3a68a552-5f9a-4760-8661-a1ccf622b729"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="ingest_issue_definition"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>

        <createTable tableName="arclib_format_developer">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_developer_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="internal_version_number" type="integer"/>
            <column name="developer_id" type="int"/>
            <column name="developer_name" type="nvarchar(255)"/>
            <column name="organisation_name" type="nvarchar(255)"/>
            <column name="developer_compound_name" type="nvarchar(255)"/>
        </createTable>

        <createTable tableName="arclib_ingest_issue_definition">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_issue_definition_pkey" nullable="false"/>
            </column>
            <column name="number" type="varchar(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="name" type="nvarchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="code" type="varchar(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="description" type="text"/>
            <column name="solution" type="text"/>
            <column name="reconfigurable" type="boolean"/>
        </createTable>

        <createTable tableName="arclib_format_definition">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_definition_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="format_id" type="varchar(255)">
                <constraints nullable="false" foreignKeyName="arclib_format_d_f_fk"
                             referencedTableName="arclib_format" referencedColumnNames="id"/>
            </column>
            <column name="format_note" type="nvarchar(255)"/>
            <column name="national_format_guarantor" type="nvarchar(255)"/>
            <column name="preservation_plan_description" type="nvarchar(255)"/>
            <column name="preservation_plan_file_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_format_p_p_f_fk"
                             referencedTableName="uas_file" referencedColumnNames="id"/>
            </column>
            <column name="previous_internal_definition_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_format_d_p_i_v_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>
            <column name="internal_version_number" type="int"/>
            <column name="local_definition" type="boolean"/>
            <column name="preferred" type="boolean"/>
            <column name="internal_information_filled" type="boolean"/>
            <column name="format_version" type="nvarchar(255)"/>
            <column name="format_classification" type="nvarchar(255)"/>
            <column name="format_description" type="nclob"/>
            <column name="release_date" type="datetime"/>
            <column name="withdrawn_date" type="datetime"/>
        </createTable>

        <createTable tableName="arclib_tool_ingest_issue_definition">
            <column name="tool_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_tool_def_tool_fk"
                             referencedTableName="arclib_tool" referencedColumnNames="id"/>
            </column>
            <column name="ingest_issue_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_tool_def_def_fk"
                             referencedTableName="arclib_ingest_issue_definition" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_occurrence">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_occurrence_pkey" nullable="false"/>
            </column>
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" deleteCascade="true" foreignKeyName="arclib_f_o_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>
            <column name="producer_profile_id" type="varchar(255)">
                <constraints nullable="false" deleteCascade="true"
                             foreignKeyName="arclib_format_occurrence_producer_profile_fk"
                             referencedTableName="arclib_producer_profile" referencedColumnNames="id"/>
            </column>
            <column name="occurrences" type="bigint"/>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
        </createTable>

        <createTable tableName="arclib_ingest_event">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_event_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="success" type="boolean"/>
            <column name="description" type="text"/>
            <column name="ingest_workflow_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_ingest_event_ingest_workflow_fk"
                             referencedTableName="arclib_ingest_workflow" referencedColumnNames="id" nullable="false"
                             deleteCascade="true"/>
            </column>
            <column name="tool_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_ingest_event_to_tool_fk"
                             referencedTableName="arclib_tool" referencedColumnNames="id" nullable="false"/>
            </column>
        </createTable>


        <createTable tableName="arclib_ingest_issue">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_ingest_issue_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="description" type="text"/>
            <column name="success" type="boolean"/>
            <column name="ingest_workflow_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_ingest_issue_ingest_workflow_fk"
                             referencedTableName="arclib_ingest_workflow" referencedColumnNames="id"
                             deleteCascade="true"/>
            </column>
            <column name="format_definition_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_issue_to_format_definition_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>
            <column name="tool_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_issue_to_tool_fk"
                             referencedTableName="arclib_tool" referencedColumnNames="id" nullable="false"/>
            </column>
            <column name="ingest_issue_definition_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_issue_to_definition_fk"
                             referencedTableName="arclib_ingest_issue_definition" referencedColumnNames="id"
                             nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_a">
            <column name="arclib_format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_a_f_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="alias" type="nvarchar(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_f_c">
            <column name="arclib_format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_f_c_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="format_classification" type="nvarchar(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_f_f">
            <column name="arclib_format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_f_f_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="format_family" type="nvarchar(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_i">
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_f_i_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="format_identifier_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_f_i_f_i_fk"
                             referencedTableName="arclib_format_identifier" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_d">
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_d_f_def_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="format_developer_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_d_f_dev_fk"
                             referencedTableName="arclib_format_developer" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_r_t">
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_d_r_t_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>

            <column name="tool_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_d_t_fk"
                             referencedTableName="arclib_tool" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_format_definition_r_f">
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_r_f_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>
            <column name="related_format_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_format_definition_r_f_r_f_fk"
                             referencedTableName="arclib_related_format" referencedColumnNames="id"/>
            </column>
        </createTable>

        <createTable tableName="arclib_formats_revision_notification">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_formats_revision_notification_pkey"
                             nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="message" type="nclob"/>
            <column name="cron" type="varchar(255)"/>
            <column name="job_id" type="varchar(255)">
                <constraints foreignKeyName="uas_job_fk"
                             referencedTableName="uas_job" referencedColumnNames="id"/>
            </column>
            <column name="creator_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>

        <insert tableName="uas_sequence">
            <column name="id" value="16ea6aab-ff6f-46d3-84a3-5afd6db216b3"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="ingest_workflow"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="arclib:2" author="hochla">
        <addColumn tableName="arclib_sip_profile">
            <column name="editable" type="boolean"/>
        </addColumn>
    </changeSet>

    <changeSet id="arclib:3" author="tomasek">
        <addColumn tableName="arclib_report">
            <column name="arclib_xml_ds" type="boolean"/>
        </addColumn>
    </changeSet>

    <changeSet id="arclib:4" author="tomasek">
        <dropTable tableName="arclib_format_definition_r_t"/>
        <dropColumn tableName="arclib_format_definition" columnName="format_classification"/>
        <dropColumn tableName="arclib_related_format" columnName="internal_version_number"/>
        <dropColumn tableName="arclib_related_format" columnName="related_format_name"/>
        <dropColumn tableName="arclib_related_format" columnName="related_format_version"/>
        <dropTable tableName="arclib_format_definition_r_f"/>
        <addColumn tableName="arclib_related_format">
            <column name="format_definition_id" type="varchar(255)">
                <constraints nullable="false" deleteCascade="true" foreignKeyName="arclib_r_f_f_d_fk"
                             referencedTableName="arclib_format_definition" referencedColumnNames="id"/>
            </column>
        </addColumn>
        <addUniqueConstraint
                columnNames="identifier_type, identifier"
                tableName="arclib_format_identifier"
        />
        <createTable tableName="arclib_format_preservation_plan_file">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_format_preservation_plan_file_pk"
                             nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="content_type" type="varchar(255)"/>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
        </createTable>
        <dropForeignKeyConstraint baseTableName="arclib_format_definition" constraintName="arclib_format_p_p_f_fk"/>
        <addForeignKeyConstraint baseTableName="arclib_format_definition" baseColumnNames="preservation_plan_file_id"
                                 constraintName="arclib_format_p_p_f_fk"
                                 referencedTableName="arclib_format_preservation_plan_file"
                                 referencedColumnNames="id"/>
        <renameTable oldTableName="arclib_risk" newTableName="arclib_format_risk"/>
        <addColumn tableName="arclib_batch">
            <column name="pending_incidents" type="boolean"/>
        </addColumn>
        <addColumn tableName="arclib_aip_deletion_request">
            <column name="rejected_by_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_rejected_by_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </addColumn>
        <addColumn tableName="arclib_ingest_routine">
            <column name="currently_processing_batch_id" type="varchar(255)">
                <constraints foreignKeyName="currently_processing_batch_fk"
                             referencedTableName="arclib_batch" referencedColumnNames="id"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="arclib:5" author="tomasek">
        <dropUniqueConstraint tableName="arclib_aip_query" constraintName="arclib_aip_query_name_key"/>
        <addColumn tableName="arclib_sip">
            <column name="size_in_bytes" type="bigint">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="arclib_ingest_workflow">
            <column name="ended" type="datetime"/>
        </addColumn>
    </changeSet>
    <changeSet id="arclib:6" author="tomasek">
        <dropUniqueConstraint tableName="arclib_sip_profile" constraintName="arclib_sip_profile_name_key"/>
        <dropUniqueConstraint tableName="arclib_validation_profile"
                              constraintName="arclib_validation_profile_name_key"/>
        <dropUniqueConstraint tableName="arclib_producer" constraintName="arclib_producer_name_key"/>
        <dropUniqueConstraint tableName="arclib_workflow_definition"
                              constraintName="arclib_workflow_definition_name_key"/>
        <dropUniqueConstraint tableName="arclib_producer_profile" constraintName="arclib_producer_profile_name_key"/>
        <dropUniqueConstraint tableName="arclib_ingest_routine" constraintName="arclib_ingest_routine_name_key"/>
        <dropUniqueConstraint tableName="arclib_format_risk" constraintName="arclib_risk_name_key"/>
    </changeSet>
    <changeSet id="arclib:7" author="tomasek">
        <addColumn tableName="arclib_report">
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
        </addColumn>
    </changeSet>
    <changeSet id="arclib:8" author="tomasek">
        <modifyDataType tableName="arclib_aip_query" columnName="query" newDataType="nclob"/>
        <modifyDataType tableName="arclib_aip_query" columnName="result" newDataType="nclob"/>
    </changeSet>
    <changeSet id="arclib:9" author="tomasek">
        <addColumn tableName="arclib_validation_profile">
            <column name="external_id" type="varchar(255)"/>
        </addColumn>
        <addColumn tableName="arclib_sip_profile">
            <column name="external_id" type="varchar(255)"/>
        </addColumn>
        <insert tableName="uas_sequence">
            <column name="id" value="9124111c-aca2-4f64-9e81-c7293aa24f47"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="validation_profile"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>
        <insert tableName="uas_sequence">
            <column name="id" value="c6eda528-df7e-4fa8-9aff-92c138a01771"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="sip_profile"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>
    </changeSet>
    <changeSet id="arclib:10" author="tomasek">
        <addColumn tableName="arclib_ingest_workflow">
            <column name="initial_config" type="nclob"/>
        </addColumn>
    </changeSet>
    <changeSet id="arclib:11" author="tomasek">
        <addColumn tableName="arclib_user">
            <column name="institution" type="nvarchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="arclib:12" author="radvan">
        <createTable tableName="arclib_user_role">
            <column name="id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="arclib_user_role_pkey"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="description" type="varchar(255)"/>
        </createTable>

        <createTable tableName="arclib_role_permission">
            <column name="arclib_role_id" type="varchar(255)">
                <constraints referencedTableName="arclib_user_role" referencedColumnNames="id"
                             foreignKeyName="arclib_role_permission_role_fk"/>
            </column>
            <column name="perm" type="varchar(255)"/>
        </createTable>

        <createTable tableName="arclib_assigned_user_role">
            <column name="arclib_user_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_assigned_role_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id" deleteCascade="true"/>
            </column>
            <column name="arclib_role_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_assigned_role_role_fk"
                             referencedTableName="arclib_user_role" referencedColumnNames="id" deleteCascade="true"/>
            </column>
        </createTable>

        <sql>
            INSERT INTO arclib_user_role (id, name, description) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'SUPER_ADMIN', 'Superadministrátor');
            INSERT INTO arclib_user_role (id, name, description) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'ADMIN', 'Administrátor');
            INSERT INTO arclib_user_role (id, name, description) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'ANALYST', 'Analytik');
            INSERT INTO arclib_user_role (id, name, description) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'ARCHIVIST', 'Archivář');

            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'USER_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'USER_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'ADMIN_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'SUPER_ADMIN_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'BATCH_PROCESSING_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'BATCH_PROCESSING_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AUTHORIAL_PACKAGE_DELETE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'DELETION_REQUESTS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'DELETION_REQUESTS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'EXPORT_ROUTINE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'EXPORT_ROUTINE_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'FORMAT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'FORMAT_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'NOTIFICATION_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'NOTIFICATION_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'INCIDENT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'INCIDENT_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'ISSUE_DEFINITIONS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'ISSUE_DEFINITIONS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'INGEST_ROUTINE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'INGEST_ROUTINE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'INGEST_WORKFLOWS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'PRODUCER_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'PRODUCER_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'PRODUCER_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'PRODUCER_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'REPORT_TEMPLATE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'REPORT_TEMPLATE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'SIP_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'SIP_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'TOOL_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'TOOL_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'VALIDATION_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'VALIDATION_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'WORKFLOW_DEFINITION_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'WORKFLOW_DEFINITION_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'DELETION_ACKNOWLEDGE_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'RISK_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'RISK_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'EXPORT_FILES');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'UPDATE_XML');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'LOGICAL_FILE_REMOVE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'LOGICAL_FILE_RENEW');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AIP_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AIP_QUERY_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AIP_QUERY_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'STORAGE_ADMINISTRATION_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'STORAGE_ADMINISTRATION_WRITE');


            -- ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'USER_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'USER_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'ADMIN_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AUTHORIAL_PACKAGE_DELETE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'BATCH_PROCESSING_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'BATCH_PROCESSING_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'DELETION_REQUESTS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'DELETION_REQUESTS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'EXPORT_ROUTINE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'EXPORT_ROUTINE_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'FORMAT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'INCIDENT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'INCIDENT_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'ISSUE_DEFINITIONS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'INGEST_ROUTINE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'INGEST_ROUTINE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'INGEST_WORKFLOWS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'PRODUCER_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'PRODUCER_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'REPORT_TEMPLATE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'REPORT_TEMPLATE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'SIP_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'SIP_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'TOOL_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'VALIDATION_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'VALIDATION_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'WORKFLOW_DEFINITION_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'WORKFLOW_DEFINITION_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'DELETION_ACKNOWLEDGE_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'RISK_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'EXPORT_FILES');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'UPDATE_XML');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'LOGICAL_FILE_REMOVE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'LOGICAL_FILE_RENEW');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AIP_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AIP_QUERY_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AIP_QUERY_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'STORAGE_ADMINISTRATION_READ');


            -- ANALYST:
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'BATCH_PROCESSING_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'BATCH_PROCESSING_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'DELETION_REQUESTS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'DELETION_REQUESTS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'FORMAT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'INCIDENT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'INCIDENT_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'ISSUE_DEFINITIONS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'INGEST_ROUTINE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'INGEST_ROUTINE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'INGEST_WORKFLOWS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'PRODUCER_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'PRODUCER_PROFILE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'REPORT_TEMPLATE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'REPORT_TEMPLATE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'SIP_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'TOOL_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'VALIDATION_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'WORKFLOW_DEFINITION_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'DELETION_ACKNOWLEDGE_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'RISK_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'EXPORT_FILES');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'LOGICAL_FILE_REMOVE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'LOGICAL_FILE_RENEW');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'AIP_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'AIP_QUERY_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'AIP_QUERY_RECORDS_WRITE');


            -- ARCHIVIST
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'BATCH_PROCESSING_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'BATCH_PROCESSING_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'AUTHORIAL_PACKAGE_DELETE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'DELETION_REQUESTS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'DELETION_REQUESTS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'FORMAT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'INCIDENT_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'ISSUE_DEFINITIONS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'INGEST_ROUTINE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'INGEST_ROUTINE_RECORDS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'INGEST_WORKFLOWS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'PRODUCER_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'SIP_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'TOOL_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'VALIDATION_PROFILE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'WORKFLOW_DEFINITION_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'DELETION_ACKNOWLEDGE_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'RISK_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'EXPORT_FILES');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'LOGICAL_FILE_REMOVE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'AIP_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'AIP_QUERY_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'AIP_QUERY_RECORDS_WRITE');
        </sql>
    </changeSet>
    <!--    <changeSet id="13" author="tomasek">--> <!-- table no longer exists -->
    <!--        <createIndex tableName="act_ru_job" indexName="">-->
    <!--            <column name="priority_" descending="true"/>-->
    <!--        </createIndex>-->
    <!--    </changeSet>-->
    <changeSet id="14" author="tomasek">
        <sql>
            DELETE FROM arclib_role_permission where perm = 'AUTHORIAL_PACKAGE_DELETE';
        </sql>
    </changeSet>
    <changeSet id="15" author="radvan">
        <sql>
            -- ANALYST:
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'EXPORT_ROUTINE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'EXPORT_ROUTINE_WRITE');
            -- ARCHIVIST
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'EXPORT_ROUTINE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'EXPORT_ROUTINE_WRITE');


            -- New Role 'DELETION_ACKNOWLEDGEMENT'
            INSERT INTO arclib_user_role (id, name, description) VALUES ('489a96f6-ec4a-4097-916c-842678ffd2ee',
            'DELETION_ACKNOWLEDGEMENT', 'Potvrzování smazání');

            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('489a96f6-ec4a-4097-916c-842678ffd2ee',
            'DELETION_ACKNOWLEDGE_PRIVILEGE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('489a96f6-ec4a-4097-916c-842678ffd2ee',
            'AIP_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('489a96f6-ec4a-4097-916c-842678ffd2ee',
            'DELETION_REQUESTS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('489a96f6-ec4a-4097-916c-842678ffd2ee',
            'DELETION_REQUESTS_WRITE');
        </sql>

        <addColumn tableName="arclib_validation_profile">
            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="validation_profile_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
        </addColumn>

        <addColumn tableName="arclib_sip_profile">
            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="sip_profile_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
        </addColumn>

        <addColumn tableName="arclib_workflow_definition">
            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="workflow_definition_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="16" author="radvan">
        <renameColumn tableName="arclib_sip_profile" oldColumnName="authorial_id_file_path_glob_pattern"
                      newColumnName="authorial_id_file_path_regex"/>
        <renameColumn tableName="arclib_sip_profile" oldColumnName="sip_metadata_path_glob_pattern"
                      newColumnName="sip_metadata_path_regex"/>
    </changeSet>
    <changeSet id="17" author="radvan">
        <sql>
            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'REINDEX_ELIGIBILITY');
        </sql>
    </changeSet>
    <changeSet id="18" author="radvan">
        <addColumn tableName="arclib_validation_profile">
            <column name="editable" type="boolean"/>
        </addColumn>

        <addColumn tableName="arclib_workflow_definition">
            <column name="editable" type="boolean"/>
        </addColumn>
    </changeSet>
    <changeSet id="19" author="radvan">
        <dropTable tableName="arclib_assigned_role"/>
        <dropTable tableName="arclib_role"/>
    </changeSet>
    <changeSet id="20" author="tomasek">
        <addNotNullConstraint tableName="arclib_producer_profile" columnName="producer_id"/>
        <addNotNullConstraint tableName="arclib_producer_profile" columnName="sip_profile_id"/>
        <addNotNullConstraint tableName="arclib_producer_profile" columnName="validation_profile_id"/>
        <addNotNullConstraint tableName="arclib_producer_profile" columnName="workflow_definition_id"/>
    </changeSet>
    <changeSet id="21" author="tomasek">
        <sql>
            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('7cef3702-7c0f-4279-9427-0028387d66d1','1','CONFIG_PARSE_ERROR','config parser error',current_timestamp,
            current_timestamp,'value in JSON config could not be parsed','see the ingest issue definition for details
            about the wrong config value and update the config',true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('48f3ff3b-d0e2-4d2d-80e5-359931866788','2','FILE_VIRUS_FOUND','virus found',current_timestamp,
            current_timestamp,'virus has been found in one or more files','the issue is solved according to mandatory
            JSON config value at /antivirus/infectedSipAction; supported config values: "IGNORE": the infected files are
            ignored and Ingest workflow process continues, "QUARANTINE": the infected files are moved to the quarantine
            and the Ingest workflow process is stopped, "CANCEL": the Ingest workflow process is stopped',true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('d36b245a-0407-44d5-882e-5afb0f6321cb','3','FILE_MISSING','missing file',current_timestamp,
            current_timestamp,'one or more files are missing in SIP','the issue may be solved by setting JSON config
            value at /fixityCheck/continueOnMissingFiles to true',true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('ae9c3f11-908a-4e78-9d83-387365a619f5','4','FILE_INVALID_CHECKSUM','invalid checksum
            (file)',current_timestamp, current_timestamp,'one or more files of SIP have invalid checksum','the issue may
            be solved by setting JSON config value at /fixityCheck/continueOnInvalidChecksums to true',true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('a8d48f32-5244-4416-adb9-eb3186d215d4','5','FILE_UNSUPPORTED_CHECKSUM_TYPE','unsupported checksum
            type',current_timestamp, current_timestamp,'one or more files of SIP is linked with checksum of unsupported
            type in the SIP metadata','the issue may be solved by setting JSON config value at
            /fixityCheck/continueOnUnsupportedChecksumType to true',true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('c6e031e7-0a54-41b8-9958-213f13bb12c8','6','FILE_FORMAT_RESOLVED_BY_CONFIG','format resolved by
            config',current_timestamp, current_timestamp,null,null,true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('39093925-e1d1-4c35-b3e1-662852e18ba8','7','FILE_FORMAT_UNRESOLVABLE','format
            unresolvable',current_timestamp, current_timestamp,null,null,true);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('1af54fb0-a3f4-4262-a3f4-60cb0959dd6e','8','AUTHORIAL_PACKAGE_LOCKED','authorial package
            locked',current_timestamp, current_timestamp,'authorial package is locked by another ongoing ingest
            process','wait until the ongoing ingest process is finished, resolve or cancel (thus cancel the ingest
            process) the respective incidents if any occurred',false);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('6e3f8886-93be-4079-a580-d2f8cca7318f','9','INTERNAL_ERROR','internal error',current_timestamp,
            current_timestamp,'unexpected system error','contact administrator',false);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('1d98c8bc-0a10-49f1-a93a-44f1b5244571','10','INVALID_CHECKSUM','invalid checksum (SIP)',current_timestamp,
            current_timestamp,'invalid checksum provided with the SIP','compute new checksum and run new batch with
            repaired SIP-hash pair through routine or through manual ingest',false);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('5ddfe482-2310-44d3-a99f-cef201c8c2b6','11','BATCH_CANCELLATION','batch cancellation',current_timestamp,
            current_timestamp,'the batch has been cancelled while the ingest workflow was waiting in queue, before its
            processing even started','',false);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('c8152325-a7e7-468a-ad0d-86dc8488b4ed','12','INCIDENT_CANCELLATION','incident
            cancellation',current_timestamp, current_timestamp,'incident has occurred during ingest and it was cancelled
            so tha ingest workflow has failed','',false);

            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('d1fca45f-4545-40db-adcf-4ecddfe023c1','13','BPM_ERROR','bpm error',current_timestamp,
            current_timestamp,'controlled error, ingest workflow has encountered a state in which it should fail (the
            failure behavior is described by JSON config)','',false);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('d920fc98-aabf-445d-9795-f56501d5e153','ARCLib_virus_check',current_timestamp,
            current_timestamp,null,null,'virus_check',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('34d50605-b886-4f14-a2a7-b2983d8d435b','ARCLib_validation',current_timestamp,
            current_timestamp,null,null,'validation',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('6d4ffc4f-56dc-45c5-9fbb-3042f651ebb9','ARCLib_message_digest_calculation',current_timestamp,
            current_timestamp,null,null,'message_digest_calculation',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('b1ffa416-c815-47c3-be0e-f7a5404a805e','ARCLib_fixity_check',current_timestamp,
            current_timestamp,null,null,'fixity_check',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('2f2aa04b-c275-4c94-8b82-60a07bc5b577','ARCLib_mets_fixity_check',current_timestamp,
            current_timestamp,null,null,'fixity_check',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('9460e07e-d00c-4729-b861-74b0c29f8527','ARCLib_bagit_fixity_check',current_timestamp,
            current_timestamp,null,null,'fixity_check',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('104968c7-bb33-4f84-ad6f-0fd4dfaf0f36','ARCLib_format_identification',current_timestamp,
            current_timestamp,null,null,'format_identification',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('e1c83f3a-c03a-4231-8c8c-102a53c0f6ed','ARCLib_metadata_extraction',current_timestamp,
            current_timestamp,null,null,'metadata_extraction',null,'ALL',null,true);

            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('c0068cb1-5755-4133-9be9-f49840f19ec3','ARCLib_information_package_creation',current_timestamp,
            current_timestamp,null,null,'information_package_creation',null,'ALL',null,true);

            INSERT INTO arclib_tool
            (id, "name", created, updated, "version", description, tool_function, license_information, documentation,
            format_relation_type, format_relation_value, internal)
            VALUES('61669cb0-2459-4715-9920-3950c8e79326', 'DROID', current_timestamp, current_timestamp, null, null,
            'format_identification', 'New BSD', null, 'ALL', null, false);

            INSERT INTO arclib_tool
            (id, "name", created, updated, "version", description, tool_function, license_information, documentation,
            format_relation_type, format_relation_value, internal)
            VALUES('801b4429-30a3-4b1b-b71f-173506f508da', 'CLAMAV', current_timestamp, current_timestamp, null, null,
            'virus_check', 'GNU', null, 'ALL', null, false);

            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('61669cb0-2459-4715-9920-3950c8e79326','39093925-e1d1-4c35-b3e1-662852e18ba8');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('61669cb0-2459-4715-9920-3950c8e79326','c6e031e7-0a54-41b8-9958-213f13bb12c8');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('61669cb0-2459-4715-9920-3950c8e79326','7cef3702-7c0f-4279-9427-0028387d66d1');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('801b4429-30a3-4b1b-b71f-173506f508da','48f3ff3b-d0e2-4d2d-80e5-359931866788');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('d920fc98-aabf-445d-9795-f56501d5e153','7cef3702-7c0f-4279-9427-0028387d66d1');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('104968c7-bb33-4f84-ad6f-0fd4dfaf0f36','7cef3702-7c0f-4279-9427-0028387d66d1');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('9460e07e-d00c-4729-b861-74b0c29f8527','a8d48f32-5244-4416-adb9-eb3186d215d4');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('9460e07e-d00c-4729-b861-74b0c29f8527','ae9c3f11-908a-4e78-9d83-387365a619f5');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('9460e07e-d00c-4729-b861-74b0c29f8527','d36b245a-0407-44d5-882e-5afb0f6321cb');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('2f2aa04b-c275-4c94-8b82-60a07bc5b577','a8d48f32-5244-4416-adb9-eb3186d215d4');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('2f2aa04b-c275-4c94-8b82-60a07bc5b577','ae9c3f11-908a-4e78-9d83-387365a619f5');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('2f2aa04b-c275-4c94-8b82-60a07bc5b577','d36b245a-0407-44d5-882e-5afb0f6321cb');
        </sql>
    </changeSet>
    <changeSet id="22" author="tomasek">
        <dropColumn tableName="arclib_sip_profile" columnName="package_type"/>
    </changeSet>
    <changeSet id="23" author="radvan">
        <sql>
            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'USER_ROLE_RECORDS_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'USER_ROLE_RECORDS_WRITE');

            -- ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'USER_ROLE_RECORDS_READ');
        </sql>
    </changeSet>
    <changeSet id="24" author="tomasek">
        <insert tableName="uas_sequence">
            <column name="id" value="71b31bd6-01ce-47a0-ae1d-5fe2277d4ebb"/>
            <column name="created" valueComputed="${now}"/>
            <column name="name" value="workflow_definition"/>
            <column name="list_order" valueNumeric="0"/>
            <column name="deletable" valueBoolean="false"/>
            <column name="active" valueBoolean="true"/>
            <column name="format" value="0"/>
            <column name="counter" valueNumeric="1"/>
        </insert>
        <addColumn tableName="arclib_workflow_definition">
            <column name="external_id" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet id="25" author="tomasek">
        <addColumn tableName="arclib_batch">
            <column name="computed_workflow_config" type="nclob"/>
            <column name="initial_workflow_definition_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_batch_workflow_definition_fk"
                             referencedTableName="arclib_workflow_definition" referencedColumnNames="id"/>
            </column>
            <column name="initial_validation_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_batch_validation_profile_fk"
                             referencedTableName="arclib_validation_profile" referencedColumnNames="id"/>
            </column>
            <column name="initial_sip_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_batch_sip_profile_fk"
                             referencedTableName="arclib_sip_profile" referencedColumnNames="id"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="26" author="radvan">
        <createTable tableName="arclib_notification">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_notification_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>

            <column name="type" type="varchar(255)"/>
            <column name="subject" type="varchar(255)"/>
            <column name="message" type="nclob"/>
            <column name="cron" type="varchar(255)"/>
            <column name="related_entities" type="clob"/> <!-- Using JSON converter -->
            <column name="job_id" type="varchar(255)">
                <constraints foreignKeyName="uas_job_fk" referencedTableName="uas_job"
                             referencedColumnNames="id"/>
            </column>
            <column name="creator_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_user_fk" referencedTableName="arclib_user"
                             referencedColumnNames="id"/>
            </column>
        </createTable>

        <!-- Remove old notification entity -->
        <dropTable tableName="arclib_formats_revision_notification" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="27" author="radvan">
        <addColumn tableName="arclib_notification">
            <column name="parameters" type="nclob"/>
        </addColumn>
    </changeSet>
    <changeSet id="28" author="radvan">
        <addColumn tableName="arclib_ingest_routine">
            <column name="auto" type="boolean" defaultValueBoolean="false"/>
        </addColumn>

        <!-- Drop old OneToOne association with Batch -->
        <dropForeignKeyConstraint baseTableName="arclib_ingest_routine" constraintName="currently_processing_batch_fk"/>
        <dropColumn tableName="arclib_ingest_routine" columnName="currently_processing_batch_id"/>
        <!-- New OneToMany association with Batch -->
        <addColumn tableName="arclib_batch">
            <column name="routine_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_batch_routine_fk"
                             referencedTableName="arclib_ingest_routine" referencedColumnNames="id"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="29" author="tomasek">
        <update tableName="arclib_ingest_routine">
            <column name="auto" value="0"/>
        </update>
        <addColumn tableName="arclib_ingest_workflow">
            <column name="processing_time" type="bigint" value="0"/>
        </addColumn>
    </changeSet>
    <changeSet id="30" author="tomasek">
        <modifyDataType tableName="arclib_format_definition" columnName="format_note" newDataType="nclob"/>
    </changeSet>
    <changeSet id="31" author="radvan">
        <addColumn tableName="arclib_format_preservation_plan_file">
            <column name="format_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_format_file_fk"
                             referencedTableName="arclib_format" referencedColumnNames="id"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="32" author="radvan">
        <dropColumn tableName="arclib_format_definition" columnName="preservation_plan_file_id"/>
    </changeSet>
    <changeSet id="33" author="tomasek">
        <createTable tableName="arclib_export_template">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_export_template_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="name" type="nvarchar(255)"/>
            <column name="description" type="nvarchar(4000)"/>
            <column name="data_reduction_mode" type="varchar(255)"/>

            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_export_template_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id" nullable="false"/>
            </column>
        </createTable>
        <createTable tableName="arclib_export_metadata_selection">
            <column name="attribute" type="varchar(255)"/>
            <column name="export_template_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_export_metadata_selection_template_id_fk"
                             referencedTableName="arclib_export_template" referencedColumnNames="id" nullable="false"/>
            </column>
        </createTable>
        <createTable tableName="arclib_export_reduction_regex">
            <column name="regex" type="nvarchar(1000)"/>
            <column name="export_template_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_export_reduction_regex_template_id_fk"
                             referencedTableName="arclib_export_template" referencedColumnNames="id" nullable="false"/>
            </column>
        </createTable>
        <sql>
            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'EXPORT_TEMPLATE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'EXPORT_TEMPLATE_WRITE');
            -- ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'EXPORT_TEMPLATE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'EXPORT_TEMPLATE_WRITE');
            -- ANALYST:
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'EXPORT_TEMPLATE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('3dd3f98e-082c-4274-9eed-1b5fb1c25e6d',
            'EXPORT_TEMPLATE_WRITE');
            -- ARCHIVIST
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'EXPORT_TEMPLATE_READ');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('6bf01064-9ab5-41cc-977f-eccf4468c5ea',
            'EXPORT_TEMPLATE_WRITE');
        </sql>
    </changeSet>
    <changeSet id="34" author="tomasek">
        <addColumn tableName="arclib_export_template">
            <column name="data_reduction_regexes" type="nclob"/>
            <column name="metadata_selection" type="nclob"/>
        </addColumn>
        <addColumn tableName="arclib_export_routine">
            <column name="scope" type="varchar(255)"/>
            <column name="data_reduction_mode" type="varchar(255)"/>
            <column name="data_reduction_regexes" type="nclob"/>
            <column name="metadata_selection" type="nclob"/>
        </addColumn>
        <dropTable tableName="arclib_export_metadata_selection"/>
        <dropTable tableName="arclib_export_reduction_regex"/>
        <dropColumn tableName="arclib_export_routine" columnName="type"/>
    </changeSet>
    <changeSet id="35" author="tomasek">
        <createTable tableName="arclib_user_export_folders">
            <column name="user_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_user_export_folders_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
            <column name="folder" type="varchar(2000)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
        <createTable tableName="arclib_producer_export_folders">
            <column name="producer_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true"
                             foreignKeyName="arclib_producer_export_folders_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
            <column name="folder" type="varchar(2000)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
        <renameColumn tableName="arclib_export_routine" oldColumnName="export_location_path"
                      newColumnName="export_folder"/>
        <addNotNullConstraint tableName="arclib_export_routine" columnName="export_folder" defaultNullValue="/tmp"/>
        <addNotNullConstraint tableName="arclib_export_routine" columnName="export_time"
                              defaultNullValue="2020-01-01 11:30:00"/>
    </changeSet>
    <changeSet id="36" author="tomasek">
        <createTable tableName="arclib_favorites_bucket">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_favorites_bucket_pkey" nullable="false"/>
            </column>
            <column name="user_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_favorites_bucket_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>
        <createTable tableName="arclib_favorites_ids">
            <column name="bucket_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_favorite_ids_bucket_fk"
                             referencedTableName="arclib_favorites_bucket" referencedColumnNames="id"/>
            </column>
            <column name="id" type="varchar(2000)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="37" author="tomasek">
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="GDFRClass"/>
            <where>identifier_type = 'GDFRCLASS'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="GDFRFormat"/>
            <where>identifier_type = 'GDFRFORMAT'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="GDFRClass"/>
            <where>identifier_type = 'GDFRCLASS'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="GDFRRegistry"/>
            <where>identifier_type = 'GDFRREGISTRY'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="4CC"/>
            <where>identifier_type = 'FOUR_CC'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="UUID/GUID"/>
            <where>identifier_type = 'UUID_GUID'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="Other"/>
            <where>identifier_type = 'OTHER'</where>
        </update>
        <update tableName="arclib_format_identifier">
            <column name="identifier_type" value="Handle"/>
            <where>identifier_type = 'HANDLE'</where>
        </update>
        <renameTable oldTableName="arclib_related_format" newTableName="arclib_format_related_format"/>
    </changeSet>
    <changeSet id="38" author="tomasek">
        <addColumn tableName="arclib_export_template">
            <column name="generate_info_file" type="boolean" value="false"/>
        </addColumn>
        <addColumn tableName="arclib_export_routine">
            <column name="generate_info_file" type="boolean" value="false"/>
        </addColumn>
    </changeSet>
    <changeSet id="39" author="tomasek">
        <sql>
            insert into arclib_tool
            (id,name,created,updated,version,description,tool_function,documentation,format_relation_type,format_relation_value,internal)
            values
            ('2ff0ff87-5292-435e-b372-efdca34bc668','ARCLib_SIP_merger',current_timestamp,
            current_timestamp,null,null,'creation',null,'ALL',null,true);
        </sql>
        <dropNotNullConstraint tableName="arclib_sip" columnName="size_in_bytes"/>
    </changeSet>
    <changeSet id="40" author="tomasek">
        <dropUniqueConstraint tableName="arclib_authorial_package"
                              constraintName="arclib_authorial_package_authorial_id_producer_profile_id_key"/>
    </changeSet>
    <changeSet id="41" author="tomasek">
        <sql>
            insert into arclib_ingest_issue_definition (id, "number",
            code,name,created,updated,description,solution,reconfigurable) values
            ('aa46b316-186d-4f6a-b54c-0cb4fd354a20','15','SYSTEM_WIDE_VALIDATION_NODE_MISSING','system wide validation
            nodes missing',
            current_timestamp, current_timestamp,'some XML nodes were not found in ARCLib XML during system wide ARCLib
            XML validation',
            'This issue may occur during validation after XSLT transformation or during final validation. It is solved
            according to optional
            JSON config values at /systemWideValidation//missingNodesAfterXsltAction and
            /systemWideValidation/missingNodesAfterFinalValidationAction.
            If no config is provided, incident is created. If config is provided, supported values are: "IGNORE":
            process
            continues as if there were no missing nodes, "CANCEL": the Ingest workflow process is cancelled.',true);

            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('e1c83f3a-c03a-4231-8c8c-102a53c0f6ed','aa46b316-186d-4f6a-b54c-0cb4fd354a20');
            insert into arclib_tool_ingest_issue_definition(tool_id,ingest_issue_definition_id)
            values('c0068cb1-5755-4133-9be9-f49840f19ec3','aa46b316-186d-4f6a-b54c-0cb4fd354a20');
        </sql>
    </changeSet>
    <changeSet id="42" author="tomasek">
        <addColumn tableName="arclib_sip">
            <column name="is_latest_version" type="boolean" value="false"/>
        </addColumn>
        <sql>
            update arclib_sip set is_latest_version = true where id in (
            select distinct on (a.id) s.id from arclib_ingest_workflow iw
            inner join arclib_sip s on iw.sip_id = s.id
            inner join arclib_authorial_package a on a.id = s.authorial_package_id
            where iw.processing_state = 'PERSISTED'
            order by a.id, iw.created desc
            );
            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AIP_BULK_DELETIONS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'AIP_BULK_DELETIONS_READ');
            -- ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AIP_BULK_DELETIONS_WRITE');
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('7354de69-e7b6-4276-96e1-6be55aa096d0',
            'AIP_BULK_DELETIONS_READ');
        </sql>
        <createTable tableName="arclib_aip_bulk_deletion">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_aip_bulk_deletion_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="producer_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_aip_bulk_deletion_producer_fk"
                             referencedTableName="arclib_producer" referencedColumnNames="id"/>
            </column>
            <column name="creator_id" type="varchar(255)">
                <constraints foreignKeyName="aip_query_creator_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id" nullable="false"/>
            </column>
            <column name="deleted_count" type="int"/>
            <column name="state" type="varchar(255)"/>
            <column name="skip_if_newer_version_not_exists" type="boolean"/>
        </createTable>
        <createTable tableName="arclib_aip_bulk_deletion_ids">
            <column name="aip_bulk_deletion_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_aip_bulk_deletion_deletion_fk"
                             referencedTableName="arclib_aip_bulk_deletion" referencedColumnNames="id"/>
            </column>
            <column name="aip_id" type="varchar(255)">
                <constraints nullable="false" primaryKey="true" foreignKeyName="arclib_aip_bulk_deletion_aip_fk"
                             referencedTableName="arclib_sip" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="43" author="tomasek">
        <renameColumn tableName="arclib_aip_bulk_deletion" oldColumnName="skip_if_newer_version_not_exists"
                      newColumnName="delete_if_newer_versions_deleted"/>
    </changeSet>
    <changeSet id="44" author="tomasek">
        <addColumn tableName="arclib_user">
            <column name="password" type="nvarchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet id="45" author="tomasek">
        <addColumn tableName="arclib_export_routine">
            <column name="id_export_type" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet id="46" author="tomasek">
        <createTable tableName="arclib_user_settings">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_user_settings_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="settings" type="text"/>
            <column name="belongs_to_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_user_settings_user_fk"
                             referencedTableName="arclib_user" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="47" author="tomasek">
        <sql>
            -- SUPER_ADMIN
            INSERT INTO arclib_role_permission (arclib_role_id, perm) VALUES ('b7a43ad5-883f-4741-948b-08678fa38604',
            'REINGEST_ELIGIBILITY');
        </sql>
        <addColumn tableName="arclib_ingest_workflow">
            <column name="final_config" type="nclob"/>
        </addColumn>
        <addColumn tableName="arclib_producer_profile">
            <column name="reingest" type="boolean" value="false"/>
        </addColumn>
    </changeSet>
    <changeSet id="48" author="tomasek">
        <createTable tableName="arclib_reingest">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_reingest_pkey" nullable="false"/>
            </column>
            <column name="created" type="datetime"/>
            <column name="updated" type="datetime"/>
            <column name="deleted" type="datetime"/>
            <column name="next_offset" type="int"/>
            <column name="size" type="int"/>
            <column name="state" type="varchar(255)"/>
            <column name="exporter_job_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_reingest_job_fk"
                             referencedTableName="uas_job" referencedColumnNames="id"/>
            </column>
        </createTable>
        <createTable tableName="arclib_reingest_item">
            <column name="id" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="arclib_reingest_item_pkey" nullable="false"/>
            </column>
            <column name="reingest_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_reingest_item_reingest_fk"
                             referencedTableName="arclib_reingest" referencedColumnNames="id"/>
            </column>
            <column name="ingest_workflow_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_reingest_item_ingest_iw_fk"
                             referencedTableName="arclib_ingest_workflow" referencedColumnNames="id"/>
            </column>
            <column name="producer_profile_id" type="varchar(255)">
                <constraints foreignKeyName="arclib_reingest_item_ingest_producer_profile_fk"
                             referencedTableName="arclib_producer_profile" referencedColumnNames="id"/>
            </column>
            <column name="config_md5" type="varchar(255)"/>
        </createTable>
        <addColumn tableName="arclib_ingest_routine">
            <column name="reingest" type="boolean" value="false"/>
        </addColumn>
        <sql>
            UPDATE uas_job SET script =
            'package scripts

            import cz.cas.lib.arclib.service.CoordinatorService

            CoordinatorService coordinatorService = spring.getBean(CoordinatorService.class);
            coordinatorService.processBatchOfSips(routineId);'
            WHERE name = 'Ingest routine';
        </sql>
        <delete tableName="uas_job_params">
            <where>key IN ('transferAreaPath','creatorId','workflowConfig','externalId')</where>
        </delete>
        <dropNotNullConstraint tableName="arclib_producer_profile" columnName="sip_profile_id"/>
        <dropNotNullConstraint tableName="arclib_producer_profile" columnName="validation_profile_id"/>
        <sql>
            UPDATE arclib_ingest_workflow aiw
            SET final_config = varConfig.text_
            FROM act_hi_varinst varId
            INNER JOIN act_hi_varinst varConfig ON varid.proc_inst_id_ = varConfig.proc_inst_id_
            WHERE aiw.external_id = varId.text_
            AND varid.name_ = 'ingestWorkflowExternalId'
            AND varConfig.name_ = 'latestConfig'
            AND aiw.processing_state = 'PERSISTED';
        </sql>
    </changeSet>
    <changeSet id="49" author="tomasek">
        <createIndex tableName="arclib_ingest_workflow" indexName="idx_arclib_ingest_workflow_external_id">
            <column name="external_id"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>
